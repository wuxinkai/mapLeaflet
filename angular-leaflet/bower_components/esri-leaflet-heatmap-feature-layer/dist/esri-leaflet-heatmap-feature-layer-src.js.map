{"version":3,"sources":["../src/HeatmapFeatureLayer.js"],"names":[],"mappings":"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","file":"esri-leaflet-heatmap-feature-layer-src.js","sourcesContent":["(function (factory) {\n  // define an AMD module that relies on 'leaflet'\n  if (typeof define === 'function' && define.amd) {\n    define(['leaflet', 'esri-leaflet'], function (L, Esri) {\n      return factory(L, Esri);\n    });\n\n  // define a common js module that relies on 'leaflet'\n  } else if (typeof module === 'object' && typeof module.exports === 'object') {\n    module.exports = factory(require('leaflet'), require('esri-leaflet'));\n  }\n\n  // define globals if we can find the proper place to attach them to.\n  if(window && window.L && window.L.esri) {\n    var HeatmapFeatureLayer = factory(L, L.esri);\n\n    window.L.esri.Layers.HeatmapFeatureLayer = HeatmapFeatureLayer;\n\n    window.L.esri.HeatmapFeatureLayer = HeatmapFeatureLayer;\n\n    window.L.esri.Layers.heatmapFeatureLayer = function(options){\n      return new HeatmapFeatureLayer(options);\n    };\n\n    window.L.esri.heatmapFeatureLayer = function(options){\n      return new HeatmapFeatureLayer(options);\n    };\n  }\n}(function (L, Esri) {\n\n  var HeatmapFeatureLayer = Esri.Layers.FeatureManager.extend({\n    /**\n     * Constructor\n     */\n\n    initialize: function (options) {\n      Esri.Layers.FeatureManager.prototype.initialize.call(this, options);\n\n      options = L.setOptions(this, options);\n\n      this._cache = {};\n      this._active = {};\n\n      this.heat = new window.L.heatLayer([], options);\n    },\n\n    /**\n     * Layer Interface\n     */\n\n    onAdd: function(map){\n      Esri.Layers.FeatureManager.prototype.onAdd.call(this, map);\n      this._map.addLayer(this.heat);\n    },\n\n    onRemove: function(map){\n      Esri.Layers.FeatureManager.prototype.onRemove.call(this, map);\n      this._map.removeLayer(this.heat);\n    },\n\n    /**\n     * Feature Managment Methods\n     */\n\n    createLayers: function(features){\n      for (var i = features.length - 1; i >= 0; i--) {\n        var geojson = features[i];\n        var id = geojson.id;\n        var latlng = new L.LatLng(geojson.geometry.coordinates[1], geojson.geometry.coordinates[0]);\n        this._cache[id] = latlng;\n\n        // add the layer if it is within the time bounds or our layer is not time enabled\n        if(!this._active[id] && (!this.options.timeField || (this.options.timeField && this._featureWithinTimeRange(geojson)))){\n          this._active[id] = latlng;\n          this.heat._latlngs.push(latlng);\n        }\n      }\n\n      this.heat.redraw();\n    },\n\n    addLayers: function(ids){\n      for (var i = ids.length - 1; i >= 0; i--) {\n        var id = ids[i];\n        if(!this._active[id]){\n          var latlng = this._cache[id];\n          this.heat._latlngs.push(latlng);\n          this._active[id] = latlng;\n        }\n      }\n      this.heat.redraw();\n    },\n\n    removeLayers: function(ids, permanent){\n      var newLatLngs = [];\n      for (var i = ids.length - 1; i >= 0; i--) {\n        var id = ids[i];\n        if(this._active[id]){\n          delete this._active[id];\n        }\n        if(this._cache[id] && permanent){\n          delete this._cache[id];\n        }\n      }\n\n      for (var latlng in this._active){\n        newLatLngs.push(this._active[latlng]);\n      }\n\n      this.heat.setLatLngs(newLatLngs);\n    }\n\n  });\n\n  return HeatmapFeatureLayer;\n}));\n"]}